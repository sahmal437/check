"use strict";!function(){function i(e,t){if(e=e,!(null!=(t=t)&&"undefined"!=typeof Symbol&&t[Symbol.hasInstance]?t[Symbol.hasInstance](e):e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function a(e,t,n){t&&o(e.prototype,t),n&&o(e,n)}var r=function(){function e(){i(this,e)}return a(e,null,[{key:"prepare",value:function(e,t,n,o){var i=_.findIndex(e,function(e){return"clipboard"===e.name}),a=_.findIndex(e,function(e){return"addNew"===e.name});return 0<=a&&e[a].actions.push({name:"x-insert",title:"Add Nested Section",icon:"hm hm-happyaddons",callback:function(){s.insert(t)},isEnabled:function(){return!0}}),e.splice(i+1,0,{name:"hax-clipboard",actions:[{name:"x-copy",title:"X Copy",icon:"hm hm-happyaddons",shortcut:o,callback:function(){n.copy(t)}},{name:"x-copy-all",title:"X Copy All",icon:"hm hm-happyaddons",shortcut:"Content",callback:function(){n.copyAll()}},{name:"x-paste",title:"X Paste",icon:"hm hm-happyaddons",shortcut:"Live Paste",callback:function(){n.paste(t)}}]}),e}},{key:"prepareForBlankColumn",value:function(e,t,n){return e.push({name:"hax-clipboard",actions:[{name:"x-copy-all",title:"X Copy All",icon:"hm hm-happyaddons",shortcut:"Content",callback:function(){n.copyAll()}},{name:"x-paste",title:"X Paste",icon:"hm hm-happyaddons",shortcut:"Live Paste",callback:function(){n.paste(t)}}]}),e}}]),e}(),s=function(){function e(){i(this,e)}return a(e,null,[{key:"insert",value:function(e){e=e.getContainer().view;"column"===e.getElementType()&&e.addElement({elType:"section",isInner:!0,settings:{},elements:[{id:elementorCommon&&elementorCommon.helpers&&elementorCommon.helpers.getUniqueId()||elementor.helpers.getUniqueID,elType:"column",isInner:!0,settings:{_column_size:100},elements:[]}]})}}]),e}(),n=function(){function n(e,t){i(this,n),this.widgetType=e,this.widgetCode=t}return a(n,[{key:"getWidgetType",value:function(){return this.widgetType}},{key:"getWidgetCode",value:function(){return this.widgetCode}},{key:"toJSON",value:function(){return{widgetType:this.widgetType,widgetCode:this.widgetCode}}}]),n}(),e=function(){function t(e){i(this,t),this.widgetStorage=e,this.lastCopiedElement="",this.lastPastedElementModel={}}return a(t,[{key:"copy",value:function(e){e=new n(e.model.get("widgetType"),e.model.toJSON());this.widgetStorage.save(e)}},{key:"copyAll",value:function(){var e=Object.values(elementor.getPreviewView().children._views).map(function(e){return e.getContainer()}).map(function(e){return e.model.toJSON()}),e=new n("page",e);this.widgetStorage.save(e)}},{key:"paste",value:function(u){var d=this;this.widgetStorage.fetch(function(e){var i;if("page"===e.widgetType&&e.widgetCode&&0<e.widgetCode.length)return i=elementor.$previewContents.find("html"),void jQuery.ajax({url:marvin.ajaxURL,method:"POST",data:{type:"import",action:"ha_process_ixport",nonce:marvin.nonce,content:JSON.stringify(e.widgetCode)},beforeSend:function(){i.addClass("ha-ixport").attr("data-ixport-text","Processing...")}}).done(function(e){var t,n,o;e.success&&(e=e.data[0],t=elementor.getPreviewContainer(),(n={}).at=t.view.collection.length,e.forEach(function(e){$e.run("document/elements/create",{container:t,model:e,options:n}),n.at++}),i.attr("data-ixport-text","Processing completed"),o=setTimeout(function(){i.removeClass("ha-ixport"),clearTimeout(o)},60))});var t,e=e.widgetCode,n=JSON.stringify(e),o=/\.(gif|jpg|jpeg|svg|png)/gi.test(n),a=u.model.get("elType"),r=e.elType,s={elType:r,settings:e.settings},l=null,c={at:0};if("section"===r?(t=null,"widget"===a?t=u.getContainer().parent.parent:"column"===a?t=u.getContainer().parent:"section"!==a&&"container"!==a||(t=u.getContainer()),s.elements=e.elements,l=t.parent,c.at=t.view.getOption("_index")+1,t.model.get("isInner")&&(s.isInner=!0)):"container"===r?(t=null,"widget"===a?t=(t=u.getContainer().parent.parent).parent?t:u.getContainer().parent:"column"===a?t=u.getContainer().parent:"section"!==a&&"container"!==a||(t=u.getContainer()),s.elements=e.elements,l=t.parent,c.at=t.view.getOption("_index")+1,t.model.get("isInner")&&(s.isInner=!0)):"column"===r?(s.elements=e.elements,"widget"===a?(l=u.getContainer().parent.parent,c.at=u.getContainer().parent.view.getOption("_index")+1):"column"===a?(l=u.getContainer().parent,c.at=u.getOption("_index")+1):"section"===a&&(l=u.getContainer())):"widget"===r&&(s.widgetType=e.widgetType,l=u.getContainer(),"widget"===a?(l=u.getContainer().parent,c.at=u.getOption("_index")+1):"column"===a?l=u.getContainer():"section"===a&&(l=u.children.findByIndex(0).getContainer())),o&&!_.isEmpty(d.lastPastedElementModel)&&d.lastCopiedElement===n)return c.clone=!0,void $e.run("document/elements/create",{model:d.lastPastedElementModel,container:l,options:c});var p=$e.run("document/elements/create",{model:s,container:l,options:c});o&&jQuery.ajax({url:marvin.ajaxURL,method:"POST",data:{type:"import",action:"ha_process_ixport",nonce:marvin.nonce,content:n},beforeSend:function(){p.view.$el.addClass("ha-ixport").attr("data-ixport-text","Processing...")}}).done(function(e){var t;e.success&&(e=e.data[0],s.settings=e.settings,s.elType=e.elType,"widget"===e.elType?s.widgetType=e.widgetType:s.elements=e.elements,p.view.$el.attr("data-ixport-text","Processing completed"),t=setTimeout(function(){$e.run("document/elements/delete",{container:p});var e=$e.run("document/elements/create",{model:s,container:l,options:c});d.lastPastedElementModel=elementorCommon.helpers.cloneObject(e.model.toJSON()),clearTimeout(t)},750))}),d.lastCopiedElement=n})}}]),t}(),t=function(){function t(e){i(this,t),this.storageKey=e,xdLocalStorage.init({iframeUrl:"https://happyaddons.com/marvin/index.html",initCallback:function(){}})}return a(t,[{key:"save",value:function(e){xdLocalStorage.setItem(this.storageKey,JSON.stringify(e))}},{key:"fetch",value:function(t){return xdLocalStorage.getItem(this.storageKey,function(e){e=JSON.parse(e.value),e=new n(e.widgetType,e.widgetCode);t(e)})}}]),t}(),l=function(){function o(e,t,n){i(this,o),this.storageKey=e,this.storageEndpoint=t,this.$=n}return a(o,[{key:"save",value:function(e){this.$.post(this.storageEndpoint,{key:this.storageKey,data:JSON.stringify(e)})}},{key:"fetch",value:function(t){this.$.get(this.storageEndpoint,{key:this.storageKey},function(e){e=JSON.parse(e),e=new n(e.widgetType,e.widgetCode);t(e)})}}]),o}(),c=(window.HWidgetStorage=t,window.HSWidgetStorage=l,window.HClipBoard=e,window.HWidget=n,/^((?!chrome|android).)*safari/i.test(navigator.userAgent)),p=elementor.hooks.addFilter,u=new e(c?new l(marvin.storageKey,"https://happymonster.dev/storage/safari.php",$):new t(marvin.storageKey));p("elements/widget/contextMenuGroups",function(e,t){return r.prepare(e,t,u,"Widget")}),p("elements/container/contextMenuGroups",function(e,t){return r.prepare(e,t,u,"Container")}),p("elements/section/contextMenuGroups",function(e,t){return r.prepare(e,t,u,"Section")}),p("elements/column/contextMenuGroups",function(e,t){return r.prepare(e,t,u,"Column")}),p("element/view",function(t,e){var n;return"column"===e.get("elType")?t.extend({initialize:function(){t.prototype.initialize.apply(this,arguments),n=this},emptyView:t.prototype.emptyView.extend({getContextMenuGroups:function(){var e=t.prototype.emptyView.prototype.getContextMenuGroups.apply(this,arguments);return r.prepareForBlankColumn(e,n,u)}})}):t})}();